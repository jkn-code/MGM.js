<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="../MGM.js"></script>
</head>

<body>
    <script>
        const Mgm = new MGM({
            name: 'Raycast',
            icon: 'Images/box1.png',
            autorun: true,
        })

        Mgm.object.unit = {
            pic: 'Images/box1.png',
            anglePic: true,
            drawText: [
                {
                    text: 'W',
                    y: 30,
                    align: 'center',
                    absolute: true,
                    alpha: 0.5,
                },
                {
                    text: 'S',
                    y: -45,
                    align: 'center',
                    absolute: true,
                    alpha: 0.5,
                },
                {
                    text: 'D',
                    x: 40,
                    y: -10,
                    align: 'center',
                    absolute: true,
                    alpha: 0.5,
                },
                {
                    text: 'A',
                    x: -40,
                    y: -10,
                    align: 'center',
                    absolute: true,
                    alpha: 0.5,
                },
            ]
        }
        Mgm.object.unit.update = th => {
            th.wasd(2)
            th.angle++
            if (dots = th.raycast(th.angle, 100, true))
                dots.forEach(dot => {
                    dot.pic = 'p2'
                    dot.alpha = 1
                })
            if (dot = th.raycast(th.angle - 180, 100)) {
                dot.pic = 'p3'
                dot.alpha = 1
            }
            th.drawLine = [
                {
                    x2: 0,
                    y2: 500,
                    color: 'yellow',
                    alpha: 0.5,
                },
                {
                    x2: 0,
                    y2: -500,
                    color: 'red',
                    alpha: 0.1,
                }
            ]
        }

        Mgm.object.dot = {
            pics: {
                p1: 'Images/a2.png',
                p2: 'Images/a1.png',
                p3: 'Images/a3.png',
            },
            active: false,
            z: -1,
            alpha: 0.3,
            t: 0,
        }
        Mgm.object.dot.start = th => {
            if (!th.active)
                for (let i = 0; i < 500; i++)
                    th.clone({
                        x: Mgm.random(-500, 500),
                        y: Mgm.random(-500, 500),
                    })
        }
        Mgm.object.dot.update = th => {
            if (th.t == 0) {
                th.pic = 'p1'
                th.alpha = 0.3
                th.t = 5
            } else th.t--
        }

        Mgm.object.noRay = {
            pic: 'Images/box2.png',
            size: 0.5,
            active: false,
            noContact: true,

            start: th => {
                for (let i = 0; i < 10; i++)
                    th.clone({
                        x: Mgm.random(-500, 500),
                        y: Mgm.random(-500, 500),
                    })
            },

            update: th => {
                th.rotation -= 1
            }
        }

    </script>
</body>

</html>